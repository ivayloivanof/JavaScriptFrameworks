"use strict";angular.module("IssueTrackingSystem.controllers.project",[]).config(["$routeProvider",function(a){a.when("/projects-all",{templateUrl:"app/project/partials/projects-all.html",controller:"Project"}).when("/projects/add",{templateUrl:"app/project/partials/project-add.html",controller:"Project"}).when("/projects/:id/edit",{templateUrl:"app/project/partials/project-edit.html",controller:"Project"}).when("/projects/:id",{templateUrl:"app/project/partials/project-view.html",controller:"Project"}).when("/projects",{templateUrl:"app/project/partials/projects.html",controller:"Project"})}]).controller("Project",["$scope","debug","projects","users","$routeParams","$location","$sessionStorage",function(o,c,f,d,n,g,m){o.prioritiesAll=[];o.getAllUsers=function(){d.getAllUsers().then(function(q){c?console.log("All users:",q):"";o.allUsers=q.data})};function j(t,q){var r,s;r={Description:t.description,Labels:[],LeadId:t.leadId,Name:t.name,Priorities:[]};t.labels=t.labels.split(",");t.labels.forEach(function(u){r.Labels.push({Name:u})});t.priorities=t.priorities.split(",");t.priorities.forEach(function(u){r.Priorities.push({Name:u})});if(q==="add"){s=t.name.split(/\s+/g);r.ProjectKey="";s.forEach(function(u){r.ProjectKey+=u.charAt(0).toUpperCase()})}return r}o.addProject=function i(q){d.getCurrentUser().then(function(r){c?console.log("Current user:",r):"";var s=j(q,"add");f.addProject(s).then(function(t){c?console.log("Success add Project:",t):"";g.path("/projects/"+t.data.Id)},function(t){console.error(t)})},function(r){console.error(r)})};o.editProject=function l(q){d.getCurrentUser().then(function(r){c?console.log("Current user:",r):"";var s=j(q,"edit");console.log(s);f.editProjectById(o.project.Id,s).then(function(t){c?console.log("Success edit Project:",t):"";g.path("/projects/"+t.data.Id)},function(t){console.error(t)})},function(r){console.error(r)})};function e(q,s){var r={};return q.filter(function(u){var t=s(u);return r.hasOwnProperty(t)?false:(r[t]=true)})}o.getAllProjects=function p(){f.getAllProjects().then(function(q){c?console.log("All projects:",q):"";o.projects=q.data;o.projects.forEach(function(r){r.Priorities.forEach(function(s){o.prioritiesAll.push(s)})});o.prioritiesAll=e(o.prioritiesAll,JSON.stringify)})};o.getMyProjects=function k(){f.getProjectByFilter(10,1,"Lead.Id",m.Id).then(function(q){c?console.log("My projects:",q):"";o.myProjects=q.data})};function b(){var q;o.labels="";for(q in o.project.Labels){o.labels+=o.project.Labels[q].Name+","}o.labels=o.labels.replace(/,(\s+)?$/,"")}function h(){var q;o.priorities="";for(q in o.project.Priorities){o.priorities+=o.project.Priorities[q].Name+","}o.priorities=o.priorities.replace(/,(\s+)?$/,"")}o.getProjectById=function a(){var q=n.project?n.project:n.id;f.getProjectById(q).then(function(r){c?console.log("Route params:",n):"";c?console.log("Project:",r):"";o.project=r.data;b();h();m.LeadId=r.data.Lead.Id})}}]);